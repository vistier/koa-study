# 第三天 KOA 中间件

```
app.use((ctx, next) => {
	console.log("中间件1 前");
	next();
	console.log("中间件1 后");
});

app.use((ctx, next) => {
	console.log("中间件2 前");
	next();
	console.log("中间件2 后");
});
```

请求URL后控制台输出
```
  <-- GET /api
中间件1 前
中间件2 前
中间件2 后
中间件1 后
  --> GET /api 200 13ms 20b

```
从测代码中我们可以观察到整个中间件模型如下, 中间件具有先进后出的特征
```
          ┌────────────────────┐
          │     middleware1    │
          │   ┌─────────────┐  │
 -request-│-> │ --action--> │->│-response->
          │   │ middleware2 │  │
          │   └─────────────┘  │
          └────────────────────┘
```
当一个请求过来的时候，会依次经过各个中间件进行处理，中间件跳转的信号是next()，当到某个中间件后，该中间件处理完不执行next()的时候，然后就会逆序执行前面那些中间件剩下的逻辑。